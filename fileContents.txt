app.py:
from flask import Flask, render_template, request
from pymongo.mongo_client import MongoClient
from pymongo.server_api import ServerApi
import json
from datetime import datetime, date

import os
from dotenv import load_dotenv
load_dotenv()


app = Flask(__name__)

# Testing Parameters
TEST_CONNECTION = False     # ? Set to True to test connection to MongoDB
REAL_DATA = False            # ? Set to False to use sample data


# MongoDB connection
mongodb_uri = os.getenv("MONGODB_URI")
client = MongoClient(mongodb_uri, server_api=ServerApi('1'))

# Select the database and collection
db = client['DTL_db']
collection = db['posts']

# Send a ping to confirm a successful connection
if TEST_CONNECTION:
    try:
        client.admin.command('ping')
        print("✅ Pinged your deployment. You successfully connected to MongoDB!")
    except Exception as e:
        print(e)

    # Add a sample document in the collection (don't add if already exists)
    name = 'John Doe'
    if collection.count_documents({'name': name}) == 0:
        collection.insert_one({'name': name})
        print("✅ Added a sample document in the collection.")

    # Retrieve the sample document added
    result = collection.find_one({'name': name})
    print(result)
    print("✅ Retrieved the sample document.")

    # Delete the sample document added
    collection.delete_one({'name': name})
    print("✅ Deleted the sample document.")


def formatData(posts_dict):

    today = date.today()

    for post in posts_dict:
        # Convert date from string to datetime object
        post['date'] = datetime.strptime(post['date'], '%Y-%m-%d')

        # Convert date to string in the format DD MMM YYYY
        post['date_str'] = post['date'].strftime('%d %b %Y')

        # Categorize the post
        if post['date'].date() > today:
            post['category'] = 'Upcoming'
        elif post['date'].date() == today:
            post['category'] = 'Today'
        else:
            post['category'] = 'Completed'

    # Sort posts by date (Newest first)
    posts_dict = sorted(posts_dict, key=lambda k: k['date'])

    return posts_dict


def getPostsData():

    posts_dict = []

    # Get data from MongoDB afterwards
    if REAL_DATA:
        posts_dict = list(collection.find({}))

    # Sample data
    else:
        with open('./static/json/sample_posts.json', 'r') as file:
            data = json.load(file)
            posts_dict = data['posts']

    posts_dict = formatData(posts_dict)

    return posts_dict


@app.route('/')
def index():

    posts_dict = getPostsData()

    return render_template('dashboard.html', posts_dict=posts_dict)


@app.route('/dashboard')
def dashboard():
    return render_template('dashboard.html')


@app.route('/events')
def events():
    return render_template('events.html')


@app.route('/events/upcoming')
def upcoming():
    posts_dict = getPostsData()
    return render_template('upcoming.html', posts_dict=posts_dict)


@app.route('/events/ongoing')
def ongoing():
    posts_dict = getPostsData()
    return render_template('ongoing.html', posts_dict=posts_dict)


@app.route('/events/completed')
def completed():
    posts_dict = getPostsData()
    return render_template('completed.html', posts_dict=posts_dict)


@app.route('/eventDetail')
def eventDetail():
    title = request.args.get('title')
    date = request.args.get('date')
    des = request.args.get('des')
    image = request.args.get('image')
    host = request.args.get('host')
    return render_template('eventDetails.html', title=title, date=date, des=des, image=image, host=host)


if __name__ == '__main__':
    app.run(debug=True)


templates/completed.html:
{% extends 'events.html' %} {% block switchbar_section %}

<!-- Switchbar Section -->
<section id="switchbar_section">
  <div id="switchbar_container">
    <a href="{{ url_for('upcoming') }}">
      <button class="left_btn switchbar_btn">Upcoming</button></a
    >
    <a href="{{ url_for('ongoing') }}"
      ><button class="switchbar_btn">Ongoing</button></a
    >
    <a href="{{ url_for('completed') }}"
      ><button class="switchbar_btn_com right_btn">Completed</button></a
    >
  </div>
</section>

{% endblock %} {% block genEvents %}

<!-- Landing Image -->
<div class="add_img_margin">
  <!-- <img src="https://i.ibb.co/X87YJ1B/Admin-block.jpg" class="img-fluid" alt="Wild Landscape" /> -->
  <h1 class="sub_title">Completed Events</h1>
</div>

<!-- Section Separator -->
<div class="section_separator"></div>

<!-- Sports -->
<section id="sports_section">
  <div class="sub_heading">Sports</div>
  <div class="addmargin row row-cols-1 row-cols-md-3 g-4">
    {% for post in posts_dict if post.tag == "s" %}
    <div class="col">
      <div class="card_align card">
        <img
          src="{{ post.image }}"
          class="img_align_card card-img-top"
          alt="Hollywood Sign on The Hill"
        />
        <div class="card-body">
          <h5 class="card-title">{{ post.title }}</h5>
          <div>
            <p class="card-text">{{ post.date_str }}</p>
            <a
              href="{{url_for('eventDetail', title=post.title, date=post.date_str, des = post.desc)}}"
              ><button class="explore_button">Explore</button></a
            >
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
</section>

<!-- Section Separator -->
<div class="section_separator"></div>

<!-- Technical -->
<section id="technical_section">
  <div class="sub_heading">Technical</div>
  <div class="addmargin row row-cols-1 row-cols-md-3 g-4">
    {% for post in posts_dict if post.tag == "t" %}
    <div class="col">
      <div class="card_align card">
        <img
          src="{{ post.image }}"
          class="img_align_card card-img-top"
          alt="Hollywood Sign on The Hill"
        />
        <div class="card-body">
          <h5 class="card-title">{{ post.title }}</h5>
          <div>
            <p class="card-text">{{ post.date_str }}</p>
            <a
              href="{{url_for('eventDetail', title=post.title, date=post.date_str, des = post.desc)}}"
              ><button class="explore_button">Explore</button></a
            >
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
</section>

<!-- Section Separator -->
<div class="section_separator"></div>

<!-- Cultural -->
<section if="cultural_section">
  <div class="sub_heading">Culutral</div>
  <div class="addmargin row row-cols-1 row-cols-md-3 g-4">
    {% for post in posts_dict if post.tag == "c" %}
    <div class="col">
      <div class="card_align card">
        <img
          src="{{ post.image }}"
          class="img_align_card card-img-top"
          alt="Hollywood Sign on The Hill"
        />
        <div class="card-body">
          <h5 class="card-title">{{ post.title }}</h5>
          <div>
            <p class="card-text">{{ post.date_str }}</p>
            <a
              href="{{url_for('eventDetail', title=post.title, date=post.date_str, des = post.desc)}}"
              ><button class="explore_button">Explore</button></a
            >
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
</section>
{% endblock %}


templates/ongoing.html:
{% extends 'events.html' %} {% block switchbar_section %}
<section id="switchbar_section">
  <div id="switchbar_container">
    <a href="{{ url_for('upcoming') }}">
      <button class="left_btn switchbar_btn">Upcoming</button></a
    >
    <a href="{{ url_for('ongoing') }}"
      ><button class="switchbar_btn_on">Ongoing</button></a
    >
    <a href="{{ url_for('completed') }}"
      ><button class="switchbar_btn right_btn">Completed</button></a
    >
  </div>
</section>
{% endblock %} {% block genEvents %}

<!-- Landing Image -->
<div class="add_img_margin">
  <!-- <img src="https://i.ibb.co/X87YJ1B/Admin-block.jpg" class="img-fluid" alt="Wild Landscape" /> -->
  <h1 class="sub_title">Ongoing Events</h1>
</div>

<!-- Section Separator -->
<div class="section_separator"></div>

<!-- Sports -->
<section id="sports_section">
  <div class="sub_heading">Sports</div>
  <div class="addmargin row row-cols-1 row-cols-md-3 g-4">
    {% for post in posts_dict if post.tag == "s" %}
    <div class="col">
      <div class="card_align card">
        <img
          src="{{ post.image }}"
          class="img_align_card card-img-top"
          alt="Hollywood Sign on The Hill"
        />
        <div class="card-body">
          <h5 class="card-title">{{ post.title }}</h5>
          <div>
            <p class="card-text">{{ post.date_str }}</p>
            <a
              href="{{url_for('eventDetail', title=post.title, date=post.date_str, des = post.desc)}}"
              ><button class="explore_button">Explore</button></a
            >
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
</section>

<!-- Section Separator -->
<div class="section_separator"></div>

<!-- Technical -->
<section id="technical_section">
  <div class="sub_heading">Technical</div>
  <div class="addmargin row row-cols-1 row-cols-md-3 g-4">
    {% for post in posts_dict if post.tag == "t" %}
    <div class="col">
      <div class="card_align card">
        <img
          src="{{ post.image }}"
          class="img_align_card card-img-top"
          alt="Hollywood Sign on The Hill"
        />
        <div class="card-body">
          <h5 class="card-title">{{ post.title }}</h5>
          <div>
            <p class="card-text">{{ post.date_str }}</p>
            <a
              href="{{url_for('eventDetail', title=post.title, date=post.date_str, des = post.desc)}}"
              ><button class="explore_button">Explore</button></a
            >
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
</section>

<!-- Section Separator -->
<div class="section_separator"></div>

<!-- Cultural -->
<section if="cultural_section">
  <div class="sub_heading">Culutral</div>
  <div class="addmargin row row-cols-1 row-cols-md-3 g-4">
    {% for post in posts_dict if post.tag == "c" %}
    <div class="col">
      <div class="card_align card">
        <img
          src="{{ post.image }}"
          class="img_align_card card-img-top"
          alt="Hollywood Sign on The Hill"
        />
        <div class="card-body">
          <h5 class="card-title">{{ post.title }}</h5>
          <div>
            <p class="card-text">{{ post.date_str }}</p>
            <a
              href="{{url_for('eventDetail', title=post.title, date=post.date_str, des = post.desc)}}"
              ><button class="explore_button">Explore</button></a
            >
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
</section>
{% endblock %}


templates/upcoming.html:
{% extends 'events.html' %} {% block switchbar_section %}
<section id="switchbar_section">
  <div id="switchbar_container">
    <a href="{{ url_for('upcoming') }}">
      <button class="left_btn switchbar_btn_up">Upcoming</button></a
    >
    <a href="{{ url_for('ongoing') }}"
      ><button class="switchbar_btn">Ongoing</button></a
    >
    <a href="{{ url_for('completed') }}"
      ><button class="switchbar_btn right_btn">Completed</button></a
    >
  </div>
</section>
{% endblock %} {% block genEvents %}

<!-- Landing Image -->
<div class="add_img_margin">
  <!-- <img src="https://i.ibb.co/X87YJ1B/Admin-block.jpg" class="img-fluid" alt="Wild Landscape" /> -->
  <h1 class="sub_title">Upcoming Events</h1>
</div>

<!-- Section Separator -->
<div class="section_separator"></div>

<!-- Sports -->
<section id="sports_section">
  <div class="sub_heading">Sports</div>
  <div class="addmargin row row-cols-1 row-cols-md-3 g-4">
    {% for post in posts_dict if post.tag == "s" %}
    <div class="col">
      <div class="card_align card">
        <img
          src="{{ post.image }}"
          class="img_align_card card-img-top"
          alt="Hollywood Sign on The Hill"
        />
        <div class="card-body">
          <h5 class="card-title">{{ post.title }}</h5>
          <div>
            <p class="card-text">{{ post.date_str }}</p>
            <a
              href="{{url_for('eventDetail', title=post.title, date=post.date_str, des = post.desc, image=post.image, host=post.clubName)}}"
              ><button class="explore_button">Explore</button></a
            >
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
</section>

<!-- Section Separator -->
<div class="section_separator"></div>

<!-- Technical -->
<section id="technical_section">
  <div class="sub_heading">Technical</div>
  <div class="addmargin row row-cols-1 row-cols-md-3 g-4">
    {% for post in posts_dict if post.tag == "t" %}
    <div class="col">
      <div class="card_align card">
        <img
          src="{{ post.image }}"
          class="img_align_card card-img-top"
          alt="Hollywood Sign on The Hill"
        />
        <div class="card-body">
          <h5 class="card-title">{{ post.title }}</h5>
          <div>
            <p class="card-text">{{ post.date_str }}</p>
            <a
              href="{{url_for('eventDetail', title=post.title, date=post.date_str, des = post.desc, image=post.image, host=post.clubName)}}"
              ><button class="explore_button">Explore</button></a
            >
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
</section>

<!-- Section Separator -->
<div class="section_separator"></div>

<!-- Cultural -->
<section if="cultural_section">
  <div class="sub_heading">Culutral</div>
  <div class="addmargin row row-cols-1 row-cols-md-3 g-4">
    {% for post in posts_dict if post.tag == "c" %}
    <div class="col">
      <div class="card_align card">
        <img
          src="{{ post.image }}"
          class="img_align_card card-img-top"
          alt="Hollywood Sign on The Hill"
        />
        <div class="card-body">
          <h5 class="card-title">{{ post.title }}</h5>
          <div>
            <p class="card-text">{{ post.date_str }}</p>
            <a
              href="{{url_for('eventDetail', title=post.title, date=post.date_str, des = post.desc, image=post.image, host=post.clubName)}}"
              ><button class="explore_button">Explore</button></a
            >
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
</section>
{% endblock %}


templates/events.html:
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Events</title>

    <!-- Custom JS -->
    <script src="{{url_for('static',filename='javaScript/script.js')}}"></script>
    <!-- Font Awesome -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap"
      rel="stylesheet"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Chela+One&display=swap"
      rel="stylesheet"
    />
    <!-- MDB -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/6.4.0/mdb.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="{{ url_for('static',filename='styles/events.css') }}"
    />
  </head>

  <body onload="playback()">
    <!-- RV logo section -->
    <section id="logo_section">
      <div class="logo">
        <img
          src="{{url_for('static', filename='Images/RVlogo.png')}}"
          alt="RV logo"
        />
      </div>
      <div class="logo_des">
        <span id="top_font">Rashtreeya Sikshana Samithi Trust</span>
        <span id="great_rv">R V College of Engineering</span>
        <span id="bottom_font"
          >Autonomous Institution affiliated to Visvesvaraya Technological
          University, Belagavi <br />
          Approved By AICTE, New Delhi, Accredited By NBA, New Delhi</span
        >
      </div>
      <div style="display: flex">
        <div><span id="since_rv">Since 1963</span></div>

        <div class="logo_right">
          <img
            src="{{url_for('static', filename='Images/RVrightLogo.jpg')}}"
            alt="RV right logo"
          />
        </div>
      </div>
    </section>

    <!-- Navbar -->
    <nav id="navbar_layout">
      <div id="nav_btn_container">
        <a href="{{ url_for('dashboard') }}">
          <button class="nav_button">Home</button></a
        >
        <button class="nav_button">Events</button>
        <button class="nav_button">Achievments</button>

        <button class="nav_button">Login</button>
        <button class="nav_button">Timeline</button>
        <!-- Admin Page Link-->
        <!-- Only after login -->
        <button class="nav_button">Admin</button>
      </div>
    </nav>

    <!-- SwitchBar -->
    {% block switchbar_section %}
    <section id="switchbar_section">
      <div id="switchbar_container">
        <a href="{{ url_for('upcoming') }}">
          <button class="switchbar_btn left_btn">Upcoming</button></a
        >
        <a href="{{ url_for('ongoing') }}"
          ><button class="switchbar_btn">Ongoing</button></a
        >
        <a href="{{ url_for('completed') }}"
          ><button class="switchbar_btn right_btn">Completed</button></a
        >
      </div>
    </section>
    {% endblock %}

    <!-- Section Separator -->
    <div class="section_separator"></div>
    {% block genEvents %}

    <!-- Events -->
    <section>
      <div class="sub_heading">
        Welcome to the centralised event hub of RVCE
      </div>
      <div class="gen_text">
        Discover a world of captivating events organized by various clubs and
        departments at our college. Stay informed about the latest happenings
        and relive memorable past events through our comprehensive event
        notification platform. Engage in stimulating discussions, showcase your
        talents, and partake in friendly competitions. Whether you're interested
        in academic pursuits, artistic expressions, or athletic endeavors, our
        website is your gateway to a plethora of enriching experiences. Stay
        connected, get involved, and make the most of your college journey as we
        keep you updated on all the exciting events taking place on campus.
      </div>
    </section>

    <!-- Carousel -->
    <section id="carousel_section">
      <section id="type_1_carousel_3">
        <div class="firstCarousel_3">
          <img
            src="https://i.ibb.co/ykRbtKR/8thMile.jpg"
            alt="Image not found"
            id="img1_3"
          />
        </div>
        <div id="midCarousel">
          <img
            src="https://i.ibb.co/gjpCPTP/fest.jpg"
            alt="Image not found"
            id="img2_3"
          />
        </div>
        <div class="firstCarousel_3">
          <img
            src="https://i.ibb.co/nBSM2Z1/marathon.jpg"
            alt="Image not found"
            id="img3_3"
          />
        </div>
      </section>
    </section>

    <!-- Section Separator -->
    <div class="section_separator"></div>

    <!--Tech Clubs Section -->
    <section id="tech_clubs_section">
      <div class="sub_heading">Technical Clubs</div>
      <div class="addmargin row row-cols-1 row-cols-md-3 g-4">
        <div class="col">
          <div class="card">
            <img
              src="https://mdbcdn.b-cdn.net/img/new/standard/city/041.webp"
              class="card-img-top"
              alt="Hollywood Sign on The Hill"
            />
          </div>
        </div>
        <div class="col">
          <div class="card">
            <img
              src="https://mdbcdn.b-cdn.net/img/new/standard/city/042.webp"
              class="card-img-top"
              alt="Palm Springs Road"
            />
          </div>
        </div>
        <div class="col">
          <div class="card">
            <img
              src="https://mdbcdn.b-cdn.net/img/new/standard/city/043.webp"
              class="card-img-top"
              alt="Los Angeles Skyscrapers"
            />
          </div>
        </div>
        <div class="col">
          <div class="card">
            <img
              src="https://mdbcdn.b-cdn.net/img/new/standard/city/044.webp"
              class="card-img-top"
              alt="Skyscrapers"
            />
          </div>
        </div>
      </div>
    </section>

    <!-- Section Separator -->
    <div class="section_separator"></div>

    <!-- Cultural Clubs Section -->
    <section id="cultural_clubs_section">
      <div class="sub_heading">Culutral Clubs</div>
      <div class="addmargin row row-cols-1 row-cols-md-3 g-4">
        <div class="col">
          <div class="card">
            <img
              src="https://mdbcdn.b-cdn.net/img/new/standard/city/041.webp"
              class="card-img-top"
              alt="Hollywood Sign on The Hill"
            />
          </div>
        </div>
        <div class="col">
          <div class="card">
            <img
              src="https://mdbcdn.b-cdn.net/img/new/standard/city/042.webp"
              class="card-img-top"
              alt="Palm Springs Road"
            />
          </div>
        </div>
        <div class="col">
          <div class="card">
            <img
              src="https://mdbcdn.b-cdn.net/img/new/standard/city/043.webp"
              class="card-img-top"
              alt="Los Angeles Skyscrapers"
            />
          </div>
        </div>
        <div class="col">
          <div class="card">
            <img
              src="https://mdbcdn.b-cdn.net/img/new/standard/city/044.webp"
              class="card-img-top"
              alt="Skyscrapers"
            />
          </div>
        </div>
      </div>
    </section>
    {% endblock %}

    <!-- Section Separator -->
    <div class="section_separator"></div>

    <!-- Footer -->

    <!-- MDB -->
    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/6.4.0/mdb.min.js"
    ></script>
  </body>
</html>


