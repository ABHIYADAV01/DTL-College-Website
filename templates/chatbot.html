<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chatbot</title>

    <!-- Favicon -->
    <link
      rel="icon"
      href="{{ url_for('static', filename='favicon/favicon2.png') }}"
    />

    <!-- Custom CSS -->
    <link
      rel="stylesheet"
      type="text/css"
      href="{{ url_for('static', filename='styles/chatbot.css') }}"
    />
  </head>

  <body class="chatbot-bckg">
    <!-- Chatbot section -->
    <section class="chatbot">
      <!-- <h2>Chatbot</h2> -->

      <img class="chatbot-icon"
        src="https://img.freepik.com/premium-vector/chatbot-icon-concept-chat-bot-chatterbot-robot-virtual-assistance-website_123447-1615.jpg"
        alt=""
      />

      <!-- Use hidden to hide the audio container -->
      <audio controls autoplay hidden>
        <source
          src="data:audio/mpeg;base64,{{ speech_base64 }}"
          type="audio/mpeg"
        />
        Your browser does not support the audio element.
      </audio>

      <!-- Form -->
      <form method="POST" action="/chatbot">
        <label for="user_input"
          >Hello, I am the DTL Chatbot. How can I help you today?</label
        >
        <select name="user_input" id="user_input">
          {% for question, choices in questionnaire.items() %}
          <option value="{{ question }}" disabled selected>
            {{ question }}
          </option>
          {% for choice in choices %}
          <option value="{{ choice }}">{{ choice }}</option>
          {% endfor %} {% endfor %}
        </select>
        <button type="submit">Get Assistance</button>
      </form>

      <!-- Display user input and bot response -->
      {% if user_input %}
      <div class="conversation">
        <div class="user-message">
          <p>You: {{ user_input }}</p>
        </div>

        <div class="bot-message">
          <!-- Use hidden to hide the audio container -->
          <audio controls autoplay hidden>
            <source
              src="data:audio/mpeg;base64,{{ response_audio }}"
              type="audio/mpeg"
            />
            Your browser does not support the audio element.
          </audio>
          <p>Bot Message: {{ response_text }}</p>
          {% if redirect_link %}
          <a target="_blank" href="{{ redirect_link }}">{{redirect_text}}</a>
          {% endif %}
        </div>
      </div>
      {% endif %}
    </section>

    <script>
      // Function to open the redirect link after 1 second
      function openRedirectLink() {
        var redirectLink = "{{ redirect_link }}"; // Get the redirect link from Flask template
        if (redirectLink) {
          setTimeout(function () {
            window.open(redirectLink, "_blank"); // Open link in a new tab
          }, 1000); // Wait for 1 second before opening the link
        }
      }

      // Call the function when the page loads
      window.onload = function () {
        openRedirectLink();
      };
    </script>
  </body>
</html>
